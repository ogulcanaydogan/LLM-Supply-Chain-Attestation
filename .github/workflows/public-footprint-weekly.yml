name: public-footprint-weekly

on:
  schedule:
    - cron: "0 3 * * 1"
  workflow_dispatch:

jobs:
  snapshot:
    runs-on: ubuntu-latest
    timeout-minutes: 20
    permissions:
      contents: read
      actions: read
      pull-requests: read
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Go
        uses: actions/setup-go@v5
        with:
          go-version: '1.25'

      - name: Run public footprint snapshot
        env:
          GH_TOKEN: ${{ github.token }}
        run: |
          chmod +x scripts/public-footprint-snapshot.sh
          ./scripts/public-footprint-snapshot.sh "${GITHUB_REPOSITORY}"

      - name: Run CI health snapshot
        env:
          GH_TOKEN: ${{ github.token }}
        run: |
          chmod +x scripts/ci-health-snapshot.sh
          ./scripts/ci-health-snapshot.sh "${GITHUB_REPOSITORY}"

      - name: Run CI pass-rate forecast
        run: |
          chmod +x scripts/ci-passrate-forecast.sh
          ./scripts/ci-passrate-forecast.sh

      - name: Run tamper and benchmark evidence
        run: |
          chmod +x scripts/tamper-tests.sh scripts/benchmark.sh
          ./scripts/tamper-tests.sh
          ./scripts/benchmark.sh

      - name: Generate measurement dashboard and evidence pack
        env:
          GH_TOKEN: ${{ github.token }}
        run: |
          chmod +x scripts/generate-evidence-pack.sh
          ./scripts/generate-evidence-pack.sh "${GITHUB_REPOSITORY}"

      - name: Generate roadmap completion check
        run: |
          chmod +x scripts/roadmap-completion-check.sh
          ./scripts/roadmap-completion-check.sh

      - name: Upload snapshot artifacts
        uses: actions/upload-artifact@v4
        with:
          name: public-footprint-snapshot
          path: .llmsa/public-footprint/**

      - name: Upload public-footprint docs
        uses: actions/upload-artifact@v4
        with:
          name: public-footprint-docs
          path: |
            docs/public-footprint/measurement-dashboard.md
            docs/public-footprint/evidence-pack-2026-02-18.md
